<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="csrf-token" content={get_csrf_token()} />
    <.live_title default="NoBullFit" suffix=" Â· NoBullFit">
      {assigns[:page_title]}
    </.live_title>
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/images/favicon-16x16.png">

    <link phx-track-static rel="stylesheet" href={~p"/assets/css/app.css"} />
    <link phx-track-static rel="stylesheet" href={~p"/assets/css/themes.css"} />
    <script defer phx-track-static type="text/javascript" src={~p"/assets/js/app.js"}></script>
    <script defer phx-track-static type="text/javascript" src={~p"/assets/js/theme_init.js"}></script>
    <%= if @current_scope && @current_scope.user do %>
    <script defer phx-track-static type="text/javascript" src={~p"/assets/js/canvasjs.min.js"}></script>
    <% end %>
    <script>
      // Detect timezone and local date immediately
      (function() {
        const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
        
        // Get local date correctly (not UTC)
        const now = new Date();
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const day = String(now.getDate()).padStart(2, '0');
        const localDate = `${year}-${month}-${day}`; // YYYY-MM-DD format
        
        window.userTimezone = timezone;
        window.userLocalDate = localDate;
        sessionStorage.setItem('user_timezone', timezone);
        sessionStorage.setItem('user_local_date', localDate);
        
        // Store timezone data globally for LiveView to access
        window.timezoneData = {
          timezone: timezone,
          localDate: localDate
        };
      })();
    </script>
  </head>
  <body>
    {@inner_content}
  </body>
</html>
